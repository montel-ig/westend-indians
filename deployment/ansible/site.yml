---

#hosts:
#  - webserver:
#    ansible_host: "80.69.173.67"


- hosts: all

  vars:
    server_name: westendindians.fi
    upstream_server: http://127.0.0.1:8001
    webhooker_user: chief
    webhooker_group: chief
    webhooker_working_dir: /home/chief/
    webhooker_config_file: files/webhooker.indians.config

  roles:
    - montel.nginx-front
    - montel.docker
    - montel.webhooker

  tasks:
    - name: Create nginx configuration for production
      become: yes
      template:
        src: files/nginx.conf.j2
        dest: /etc/nginx/conf.d/production.conf
      notify:
        - restart nginx

    - name: Copy site update script
      copy: src=files/update.sh dest=/home/chief/update.sh
